"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7206],{7206:function(e,t,n){n.r(t),n.d(t,{prepareToRunPageEditorAction:function(){return W},loadWidget:function(){return J},deleteSingleArticle:function(){return z},savePage:function(){return V},publishPage:function(){return K},saveCollectionArticle:function(){return X},getNewsletterSubscriptions:function(){return Y},addNewsletterSubscription:function(){return $}});var r=n(88753),a=n.n(r),i=n(93586),o=n(52198),c=n(80944),u=n(16962),s=n(27913),l=n(98411),d=n(12006),p=n(44124),v=n(34560),f=n(49227),g=n(97242),h=n(74013),m=n(51127),_=n(59290),x=n(10980),b=n(56651),w=n(39064),y=n(20767),k=n(84283),S=n(60136),O=n(53114),C=n(17438),E=n(95621);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A=function(e,t,n){return function(){var r=(0,o.Z)(a().mark((function r(i){var o,u;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=JSON.parse(t),e=I(I({},e),{},{content:I(I({},e.content),{},{image_id:t.image_id})}),o=t.upload_url,r.next=5,fetch(e.content.file).then((function(e){return e.blob()}));case 5:return u=r.sent,URL.revokeObjectURL(e.content.file),r.next=9,(0,c.iL)({upload_url:o,file:u});case 9:delete e.content.file,n?(0,C.eB)(n,e.content.comp_id,{image_id:e.content.image_id,file:null,svgString:null}):i(s.oh.updateContentState(e.hash,{image_id:e.content.image_id,file:null,svgString:null}));case 11:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()},R=function(e,t,n,r,i){return function(){var u=(0,o.Z)(a().mark((function u(s){return a().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",new Promise(function(){var u=(0,o.Z)(a().mark((function o(u,l){var d;return a().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,c.i1)({author_id:e,collection_id:t,page_id:n});case 3:return d=a.sent,a.next=6,s(A(r,d,i));case 6:u(),a.next=12;break;case 9:a.prev=9,a.t0=a.catch(0),l(a.t0);case 12:case"end":return a.stop()}}),o,null,[[0,9]])})));return function(e,t){return u.apply(this,arguments)}}()));case 1:case"end":return u.stop()}}),u)})));return function(e){return u.apply(this,arguments)}}()},U=function(e,t,n,r,i){return function(){var u=(0,o.Z)(a().mark((function u(l){return a().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",new Promise(function(){var u=(0,o.Z)(a().mark((function o(u,d){var p,v,g,h,m,_,x,b;return a().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:a.prev=0,p=r,v=0;case 3:if(!(v<(null===(g=r.content)||void 0===g?void 0:g.options.length))){a.next=22;break}if((x=null===(h=r.content)||void 0===h?void 0:h.options[v]).blockType!==f.$W.IMAGE||null!==(m=x.content)&&void 0!==m&&null!==(_=m.data)&&void 0!==_&&_.image_id){a.next=19;break}if(!t||!e){a.next=12;break}return a.next=9,(0,c.i1)({author_id:e,collection_id:t,page_id:n});case 9:a.t0=a.sent,a.next=15;break;case 12:return a.next=14,(0,c.hv)(n);case 14:a.t0=a.sent;case 15:return b=a.t0,a.next=18,(0,E.k)(p,b,i,v,c.iL,C.eB,s.oh.updateContentState,l);case 18:p=a.sent;case 19:v++,a.next=3;break;case 22:u(),a.next=28;break;case 25:a.prev=25,a.t1=a.catch(0),d(a.t1);case 28:case"end":return a.stop()}}),o,null,[[0,25]])})));return function(e,t){return u.apply(this,arguments)}}()));case 1:case"end":return u.stop()}}),u)})));return function(e){return u.apply(this,arguments)}}()},P=function(e,t,n){return function(){var r=(0,o.Z)(a().mark((function r(i){return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(){var r=(0,o.Z)(a().mark((function r(o,u){var s;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,(0,c.hv)(t);case 3:return s=r.sent,r.next=6,i(A(e,s,n));case 6:o(),r.next=12;break;case 9:r.prev=9,r.t0=r.catch(0),u(r.t0);case 12:case"end":return r.stop()}}),r,null,[[0,9]])})));return function(e,t){return r.apply(this,arguments)}}()));case 1:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()},Z=function(e){return e.map((function(e){return e.content.image_id}))},L=function e(t,n){var r=0,a=t.type;switch(a){case"Image":case"Chart":case"Graph":case"Matrix":case"LinkedList":case"EducativeArray":case"BinaryTree":case"NaryTree":case"Stack":case"HashTable":case"Graphviz":case"SVGEdit":case"SVG":case"Canvas":case"MxGraphWidget":case"SequenceDiagrams":case"UML":case"Mermaid":case"MarkMap":r++}"MarkdownEditor"===a&&(r+=(t.content.mdHtml.match(/img/g)||[]).length),"Columns"===a&&t.content.comps&&t.content.comps.forEach((function(t){e(t,n)})),"CanvasAnimation"===a&&(r+=t.content.canvasObjects.length),"illustrations"in n?n.illustrations+=r:n.illustrations=r},j=function(e){var t={};return e.forEach((function(e){var n=e.type;n in t?t[n]++:t[n]=1,function(e,t){var n=0,r=0,a=0,i=e.type;if("RunJS"===i){var o,c,u,s,l=null===e||void 0===e||null===(o=e.content)||void 0===o||null===(c=o.jotted)||void 0===c?void 0:c.exercise,d=null===e||void 0===e||null===(u=e.content)||void 0===u||null===(s=u.jotted)||void 0===s?void 0:s.showSolution;l||d?r++:n++}else if("WebpackBin"===i){var p,v,f;(null===e||void 0===e||null===(p=e.content)||void 0===p||null===(v=p.codeContents)||void 0===v||null===(f=v.judge)||void 0===f?void 0:f.judgeActive)?r++:n++}else if("Code"===i)e.content.runnable?n++:e.content.judge?r++:a++;else if("TabbedCode"===i)e.content.codeContents.forEach((function(e){e.runnable?n++:e.judge?r++:a++}));else if("LiveApp"===i)n++;else if("TerminalWidget"===i)n++;else if("MarkdownEditor"===i){var g=document.createElement("div");g.innerHTML=e.content.mdHtml,a+=Array.from(g.querySelectorAll("pre")).filter((function(e){return e.querySelectorAll("code").length>0})).length}"codeExerciseCount"in t?t.codeExerciseCount+=r:t.codeExerciseCount=r,"codeRunnableCount"in t?t.codeRunnableCount+=n:t.codeRunnableCount=n,"codeSnippetCount"in t?t.codeSnippetCount+=a:t.codeSnippetCount=a}(e,t),L(e,t)})),JSON.stringify(t)},N=function(e,t,n,r,a,i){return function(o){return new Promise((function(c,l){for(var d=[],p=[],v=[],f=0;f<a.length;f++){"Image"===a[f].type||"File"===a[f].type?(v.push(a[f]),null===a[f].content.image_id&&a[f].content.file&&d.push(a[f])):(0,E.o)(a[f])&&p.push(a[f]);var g=(0,O.s)(a[f]);g&&d.push(g),!a[f].content||a[f].content.comp_id||i||o(s.oh.updateContentState(a[f].hash,(function(e){e.comp_id=(0,y.x0)()})))}var h=[];if(d.length>0||p.length>0){o(u.n.update({status:"WAIT",text:"Uploading Files and Images"}));for(var m=0;m<d.length;m++)n?h.push(o(R(e,n,t,d[m],i))):h.push(o(P(d[m],t,i)));for(var _=0;_<p.length;_++)h.push(o(U(e,n,t,p[_],i)));Promise.all(h).then((function(){var e=Z(v);c({cover_image:r,validImageIds:e})}),(function(e){console.error(e),l(e),o(u.n.update({status:"ERROR",text:"Uploading File or Image failed. Please retry"}))}))}else{var x=Z(v);c({cover_image:r,validImageIds:x})}}))}},D=function(e,t,n,r){return JSON.stringify({components:t,summary:n,cover_image_id:r.image_id,cover_image_metadata:r.metadata})},W=function(e,t,n,r,i,s,l,p){var v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",f=arguments.length>9?arguments[9]:void 0;return function(){var g=(0,o.Z)(a().mark((function o(g){var h,m;return a().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(g(u.n.show(d.ad,{status:"WAIT",text:"Starting to Save"})),!e.file||!e.updated){a.next=20;break}return g(u.n.update({status:"WAIT",text:"Uploading Files and Images"})),a.prev=3,a.next=6,(0,c.iL)(e);case 6:return h=a.sent,(m=JSON.parse(h))&&(e.updated=!1,e.file_name=m.file_name,e.image="".concat(t,"/").concat(m.image_id),e.image_id=m.image_id),a.next=11,r(e);case 11:s(n,e,i,l,p,v,f),a.next=18;break;case 14:a.prev=14,a.t0=a.catch(3),g(u.n.update({status:"ERROR",text:"Upload Image failed"})),console.error(a.t0);case 18:a.next=21;break;case 20:s(n,e,i,l,p,v,f);case 21:case"end":return a.stop()}}),o,null,[[3,14]])})));return function(e){return g.apply(this,arguments)}}()},M=function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",c=arguments.length>7?arguments[7]:void 0;return function(u,l){var d,p,v=l().widgets.selectedHash,f=c&&(null===(d=c.children[v])||void 0===d||null===(p=d.content)||void 0===p?void 0:p.comp_id);-1!==(c?c.children.findIndex((function(e){var t;return(null===(t=e.content)||void 0===t?void 0:t.comp_id)===f&&f})):l().widgets.ids.indexOf(v))?(e((function(){return u(t(n,r,a,i,!0,o,c))})),c?(0,C.YR)(c,f):u(s.oh.bumpVersion())):u(t(n,r,a,i,!0,o,c))}},J=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n,r){var a,i,o,c=r().author,u=null===c||void 0===c||null===(a=c.collectionArticle)||void 0===a?void 0:a.data,l=null===c||void 0===c||null===(i=c.proofread)||void 0===i||null===(o=i.data)||void 0===o?void 0:o.page,d=t?null===l||void 0===l?void 0:l.components:null===u||void 0===u?void 0:u.components,p=r().widgets.ids.indexOf(e),v=null===d||void 0===d?void 0:d[p];return n(s.oh.addOnExistingHash({data:v,hash:e}))}},B=function(e,t,n,r,i){return function(){var t=(0,o.Z)(a().mark((function t(o,s){var l,p,v,f,g,m,_,y,k,S,O,E,T,A,R,U,P,Z,L,N,W,M,J,B;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o(u.n.showOrUpdate(d.ad,{status:"WAIT",text:"Optimizing Article to save"})),m=s(),_=m.author,_.page.data,y=_.collection,k=m.pageSummary,S=m.widgets,O=(null===y||void 0===y||null===(l=y.instance)||void 0===l?void 0:l.details.is_plan)||(null===y||void 0===y||null===(p=y.instance)||void 0===p?void 0:p.details.is_parent_plan),E=i?(0,C.gK)(i):S.ids.map((function(e){return S.entities[e]})),T=n.author_id,A=n.collection_id,R=n.page_id,t.next=7,(0,h.TE)(E);case 7:if(U=t.sent,P=U.TOC,Z=A&&(null===y||void 0===y||null===(v=y.instance)||void 0===v||null===(f=v.details)||void 0===f||null===(g=f.page_titles)||void 0===g?void 0:g[R]),delete(L=I({},k)).dirty,N=D(0,E,L,e),W=j(E),M=JSON.stringify((0,x.D)(E)),o(u.n.showOrUpdate(d.ad,{status:"WAIT",text:"Saving ".concat(O?"Task":"Article")})),o(b.I.change({titleUpdated:!0})),J=e.metadata?JSON.stringify(e.metadata):"",B=L.tags?L.tags.toString():"",A){t.next=23;break}if(R){t.next=22;break}return t.abrupt("return",new Promise((function(e){return e()})));case 22:return t.abrupt("return",(0,c.Is)({pageId:R,page_title:L.title,page_summary:L.description,page_table_of_content:P,page_table_of_content_is_enabled:L.pageTocEnabled,price:L.price,is_priced:L.is_priced||"false",version:L.version,tags:B,page_content_encoding:"deflate",page_content:N,cover_image_id:e.image_id,cover_image_metadata:J,widget_stats:W,feedback_email:L.feedback_email,feedback_email_2:L.feedback_email_2,concept_list:M,eTag:r}));case 23:return t.abrupt("return",new Promise((function(t,n){(0,c.EO)({authorId:T,collectionId:A,pageId:R,page_title:Z,page_summary:L.description,page_table_of_content:P,price:L.price,is_priced:L.is_priced,version:L.version,tags:B,page_content_encoding:"deflate",page_content:N,cover_image_id:e.image_id,cover_image_metadata:J,widget_stats:W,concept_list:M,eTag:r}).then((function(e){"success"===(null===e||void 0===e?void 0:e.status)&&o(w.X5.updateArticleTags({pageId:R,tags:B})),t()})).catch((function(e){n(e)}))})));case 24:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},q=function(e,t,n,r,i,v,h){var _=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",x=arguments.length>8?arguments[8]:void 0;return function(){var b=(0,o.Z)(a().mark((function b(w,y){return a().wrap((function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt("return",new Promise(function(){var b=(0,o.Z)(a().mark((function b(k,O){var E,T,I,A,R,U,P,Z,L,j,D,W,M,J,q,F,G,H,z;return a().wrap((function(b){for(;;)switch(b.prev=b.next){case 0:if(T=y(),I=T.widgets,A=T.author,R=!(null===(E=A.collection.instance.details)||void 0===E||!E.allow_custom_styling_editor_side),U=n.author_id,P=n.collection_id,Z=n.page_id,L=x?(0,C.gK)(x):I.ids.map((function(e){return I.entities[e]})),R||!(0,g.fg)(L)){b.next=6;break}return b.abrupt("return",w(u.n.update({status:"ERROR",text:"Unable to save changes due to custom styles"})));case 6:if(b.prev=6,!I.markdownDirty){b.next=30;break}return b.prev=8,b.prev=9,b.next=12,(0,g.SB)(L,!1,f.sL.COLLECTION);case 12:w(s.oh.resetMarkdownDirtyBit()),b.next=25;break;case 15:if(b.prev=15,b.t0=b.catch(9),!("errors"in b.t0)||!("headingTree"in b.t0)){b.next=24;break}if(j=b.t0.errors,D=b.t0.headingTree,!(null!==j&&void 0!==j?j:[]).length){b.next=22;break}return w(u.n.show(d.Xw,{workType:f.sL.COLLECTION,errors:j,comps:L,dispatch:w,fixHeadings:function(){var e=(0,o.Z)(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,g.dC)(L,j,D);case 2:t=e.sent,x?(0,C.hv)(x,t):(0,g.bc)(w,t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()})),b.abrupt("return");case 22:b.next=25;break;case 24:throw b.t0;case 25:b.next=30;break;case 27:b.prev=27,b.t1=b.catch(8),(0,S.u)(b.t1);case 30:return b.next=32,w(N(U,Z,t?P:null,e,L,x));case 32:return W=b.sent,M=W.cover_image,W.validImageIds,b.next=37,w(B(M,0,n,i||"",x));case 37:if(k({selAfterSave:L.length?L[0].hash:-1}),w(m.x.updateLastModified()),!_){b.next=42;break}return b.next=42,(0,c.bU)(_,{author_id:U,collection_id:P,page_id:Z,page_type:f.sL.COLLECTION},w);case 42:b.next=48;break;case 44:b.prev=44,b.t2=b.catch(6),(0,l.rU)(b.t2,w),b.t2.status===p.Wy.AlreadyExistsException?(w(u.n.close()),w(u.n.show(d.zN,{onConfirm:function(){return w(v(e,n,r,h,!1,_,x))},cancelText:"Cancel",confirmText:"Save",title:"Conflicts",description:"The content you are editing has changed. The previous changes will be overwritten. Are you sure you want to save?"}))):(z=(null===b.t2||void 0===b.t2||null===(J=b.t2.responseJSON)||void 0===J||null===(q=J.errors)||void 0===q?void 0:q.page_title)||(null===b.t2||void 0===b.t2||null===(F=b.t2.responseJSON)||void 0===F||null===(G=F.errors)||void 0===G?void 0:G.page_summary)||(null===b.t2||void 0===b.t2||null===(H=b.t2.responseJSON)||void 0===H?void 0:H.errorText)||"Unable to Save Changes",w(u.n.update({status:"ERROR",text:z})));case 48:r&&r();case 49:case"end":return b.stop()}}),b,null,[[6,44],[8,27],[9,15]])})));return function(e,t){return b.apply(this,arguments)}}()));case 1:case"end":return b.stop()}}),b)})));return function(e,t){return b.apply(this,arguments)}}()},F=function e(t,n,r,i){var c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],d=arguments.length>5?arguments[5]:void 0,p=arguments.length>6?arguments[6]:void 0;return function(){var g=(0,o.Z)(a().mark((function o(g,h){var m,_,x,w,y,k,S,O,C;return a().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return k=h(),S=k.author,O=c?null===(m=S.page.data)||void 0===m?void 0:m[v.Zq]:f.Fh,C=(null===(_=S.collection)||void 0===_||null===(x=_.instance)||void 0===x?void 0:x.details.is_plan)||(null===(w=S.collection)||void 0===w||null===(y=w.instance)||void 0===y?void 0:y.details.is_parent_plan),a.prev=3,a.next=6,g(q(t,!1,n,r,O,e,i,d,p));case 6:g(u.n.update({status:"SUCCESS",text:"".concat(C?"Task":"Article"," Saved successfully")})),g(b.I.change({dirty:!1})),g(s.oh.resetDirtyBit()),a.next=16;break;case 11:a.prev=11,a.t0=a.catch(3),console.log(a.t0),(0,l.rU)(a.t0,g),g(u.n.update({status:"ERROR",text:"Unable to Save"}));case 16:case"end":return a.stop()}}),o,null,[[3,11]])})));return function(e,t){return g.apply(this,arguments)}}()},G=function e(t,n,r,i){var s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],d=arguments.length>5?arguments[5]:void 0,p=arguments.length>6?arguments[6]:void 0;return function(){var g=(0,o.Z)(a().mark((function o(g,h){var m,_,x,b,w,y,k,S;return a().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return w=h(),y=w.user.info.data,k=n.page_id,S=s?null===(m=h())||void 0===m||null===(_=m.author)||void 0===_||null===(x=_.page)||void 0===x||null===(b=x.data)||void 0===b?void 0:b[v.Zq]:f.Fh,a.next=5,g(q(t,!1,n,r,S,e,i,d,p));case 5:return g(u.n.update({status:"WAIT",text:"Publishing Article"})),a.abrupt("return",(0,c.eb)(k).then((function(){g(u.n.update({status:"SUCCESS",text:"Article is now Published"})),i.push("/page/".concat(y.user_id,"/").concat(k))})).catch((function(e){console.log(e),(0,l.rU)(e,g),g(u.n.update({status:"ERROR",text:"Unable to Publish"}))})));case 7:case"end":return a.stop()}}),o)})));return function(e,t){return g.apply(this,arguments)}}()},H=function e(t,n,r,i){var c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",p=arguments.length>6?arguments[6]:void 0;return function(){var g=(0,o.Z)(a().mark((function o(g,h){var m,_,x,w,y,k,S,O,C;return a().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return k=h(),S=k.author,O=c?null===(m=S.collectionArticle.data)||void 0===m?void 0:m[v.Zq]:f.Fh,C=(null===(_=S.collection)||void 0===_||null===(x=_.instance)||void 0===x?void 0:x.details.is_plan)||(null===(w=S.collection)||void 0===w||null===(y=w.instance)||void 0===y?void 0:y.details.is_parent_plan),a.prev=3,a.next=6,g(q(t,!0,n,r,O,e,i,d,p));case 6:g(u.n.update({status:"SUCCESS",text:"".concat(C?"Task":"Article"," Saved successfully")})),g(b.I.change({dirty:!1})),g(s.oh.resetDirtyBit()),a.next=16;break;case 11:a.prev=11,a.t0=a.catch(3),console.log(a.t0),(0,l.rU)(a.t0,g),g(u.n.update({status:"ERROR",text:"Unable to Save"}));case 16:case"end":return a.stop()}}),o,null,[[3,11]])})));return function(e,t){return g.apply(this,arguments)}}()},z=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(r){return r(u.n.show(d.ad,{status:"WAIT",text:"Deleting Article"})),(0,c.CT)(e).then((function(){r(u.n.update({status:"SUCCESS",text:"Article deleted"})),r(_.B.delete(e)),n&&t.push({pathname:"/teach",query:{isDeleted:!0}})})).catch((function(e){console.log(e),(0,l.rU)(e,r),r(u.n.update({status:"ERROR",text:"Unable to Delete"}))}))}},V=function(e,t,n,r,a,i,o){return M(e,F,t,n,r,a,i,o)},K=function(e,t,n,r,a,i,o){return M(e,G,t,n,r,a,i,o)},X=function(e,t,n,r,a,i,o){return M(e,H,t,n,r,a,i,o)},Y=function(e){return(0,k.Z)({url:"/api/user/newsletter/".concat(e),type:"GET"})},$=function(e,t,n){var r=void 0;return t&&n&&(r={full_name:t,email:n}),(0,k.Z)({url:"/api/user/newsletter/".concat(e),type:"POST",data:r})}}}]);
//# sourceMappingURL=7206-fee2284640b50cdce678.js.map